<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>Product Detail</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>

<div th:replace="~{fragments :: navbar}"></div>

<div class="container border border-1 row" style="margin: 50px auto; padding: 10px;">

    <div class="col-sm-6">
        <img th:src="@{/images/image_cat_horizontal.jpg}" style="max-width: 600px; max-height: 300px;">
    </div>

    <div class="col-sm-6">
        <form id="productForm" th:object="${productInfo}" method="post">
            <input type="hidden" th:name="id" th:value="${product.id}">
            <input type="hidden" th:name="quantity" th:value="${product.quantity}">
            <h4>[[${product.name}]]</h4>

            <div th:if="${product.discountPrice == null}">
                <p>Giá: [[${product.price}]]đ</p>
            </div>
            <div th:if="${product.discountPrice != null}">
                <s>Giá: [[${product.price}]]đ</s>
                [[${product.discountPrice}]]đ
            </div>

            <div class="mt-2">
                Số lượng: <input type="number" min="1" th:name="qty" value="1" class="border text-center"
                                 style="width: 50px; height: 30px;">&nbsp; [[${product.quantity}]] sản phẩm có sẵn

            </div>
            <div class="mt-3 mb-5">
                [[${product.description}]]
            </div>

            <th:block sec:authorize="hasAnyAuthority('GUEST', 'USER', 'ADMIN')">
                <button id="addToCart" class="btn btn-outline-primary">Thêm vào giỏ hàng</button>
            </th:block>

            <button id="buyNowButton" class="btn btn-success" sec:authorize="hasAnyAuthority('USER','ADMIN')">Mua ngay
            </button>

        </form>
        <div th:if="${greaterThanQty != null}" style="color: red">
            [[${greaterThanQty}]]
        </div>
    </div>

</div>

<script type="text/javascript">

    const productForm = document.getElementById('productForm');
    const addToCartButton = document.getElementById('addToCart');
    const buyNowButton = document.getElementById('buyNowButton');

    buyNowButton.addEventListener('click', function (e) {
        e.preventDefault();

        productForm.action = "/buy-now/view-payment";
        productForm.submit();
    })

    addToCartButton.addEventListener('click', function (e) {
        e.preventDefault();

        productForm.action = "/add-to-cart/add-product";
        productForm.submit();
    });

</script>

<script th:src="@{/js/common.js}"></script>

</body>
</html>